#!/bin/bash

# The spell definition file
JSON_FILE='occultist.json'
LOCK_FILE='occultist-lock.json'
HOST='https://occultist-io.now.sh'
API_BASE="$HOST/api"
PROGRAM='Occultist'
DESCRIPTION='Dependency manager for the Chaos language'

# Terminal colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
NC='\033[0m' # No Color
BOLD_NC='\033[1m'
UNDERLINED_NC='\033[4m'

clear
printf "${YELLOW}%s${NC} - %s - ${YELLOW}%s${NC}\n" "$PROGRAM" "$DESCRIPTION" "$HOST"
# Occultist icon ANSI colors
cat << "EOF"
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;234m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m.[39m[38;5;232m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;237m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;233m.[39m[38;5;235m,[39m[38;5;237m:[39m[38;5;239m;[39m[38;5;240mi[39m[38;5;240mi[39m[38;5;239m;[39m[38;5;237m:[39m[38;5;235m,[39m[38;5;233m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m [39m[38;5;233m.[39m[38;5;235m,[39m[38;5;237m:[39m[38;5;239mi[39m[38;5;241mi[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241mi[39m[38;5;239mi[39m[38;5;237m:[39m[38;5;235m,[39m[38;5;233m.[39m[38;5;232m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;235m,[39m[38;5;238m;[39m[38;5;240mi[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;240mi[39m[38;5;238m;[39m[38;5;235m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;234m.[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;234m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m.[39m[38;5;239mi[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;102m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;239mi[39m[38;5;232m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;238m;[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;102m1[39m[38;5;240mi[39m[38;5;59m;[39m[38;5;59m:[39m[38;5;235m,[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;235m,[39m[38;5;59m:[39m[38;5;59m;[39m[38;5;240mi[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;238m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;235m,[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;102mi[39m[38;5;239mi[39m[38;5;237m:[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;59m:[39m[38;5;102mi[39m[38;5;144mt[39m[38;5;181mL[39m[38;5;181mL[39m[38;5;144mt[39m[38;5;102mi[39m[38;5;59m:[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;236m,[39m[38;5;59m:[39m[38;5;102m;[39m[38;5;241mi[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;235m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;233m.[39m[38;5;241mi[39m[38;5;241m1[39m[38;5;238m;[39m[38;5;236m:[39m[38;5;234m,[39m[38;5;58m.[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;101mi[39m[38;5;144mt[39m[38;5;181mL[39m[38;5;187mC[39m[38;5;187mG[39m[38;5;187mG[39m[38;5;187mC[39m[38;5;187mC[39m[38;5;187mG[39m[38;5;187mG[39m[38;5;187mC[39m[38;5;181mL[39m[38;5;144mf[39m[38;5;101mi[39m[38;5;59m;[39m[38;5;59m:[39m[38;5;58m.[39m[38;5;234m,[39m[38;5;236m:[39m[38;5;238m;[39m[38;5;241m1[39m[38;5;241mi[39m[38;5;233m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m [39m[38;5;239m;[39m[38;5;242m1[39m[38;5;241mi[39m[38;5;236m:[39m[38;5;235m,[39m[38;5;16m [39m[38;5;59m;[39m[38;5;187mC[39m[38;5;138mt[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;59m;[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;59m;[39m[38;5;59m;[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;59m;[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;138mt[39m[38;5;187mC[39m[38;5;59m;[39m[38;5;16m [39m[38;5;235m,[39m[38;5;236m:[39m[38;5;241mi[39m[38;5;242m1[39m[38;5;239m;[39m[38;5;232m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;237m:[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;239m;[39m[38;5;16m [39m[38;5;101m;[39m[38;5;187mG[39m[38;5;187mG[39m[38;5;187mC[39m[38;5;181mC[39m[38;5;181mL[39m[38;5;187mC[39m[38;5;187mG[39m[38;5;187mG[39m[38;5;224mG[39m[38;5;224mG[39m[38;5;187mG[39m[38;5;187mG[39m[38;5;187mC[39m[38;5;181mL[39m[38;5;187mC[39m[38;5;187mC[39m[38;5;187mG[39m[38;5;187mG[39m[38;5;101m;[39m[38;5;16m [39m[38;5;239m;[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;237m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;235m,[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;239m;[39m[38;5;16m [39m[38;5;101mi[39m[38;5;230m0[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;224m0[39m[38;5;101m;[39m[38;5;101m;[39m[38;5;224m0[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m0[39m[38;5;101mi[39m[38;5;16m [39m[38;5;239m;[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;235m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;233m.[39m[38;5;238m;[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241mi[39m[38;5;234m,[39m[38;5;16m.[39m[38;5;144mt[39m[38;5;224m0[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;224m0[39m[38;5;138m1[39m[38;5;138m1[39m[38;5;224m0[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;224m0[39m[38;5;144mt[39m[38;5;16m.[39m[38;5;234m,[39m[38;5;241mi[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;238m;[39m[38;5;233m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;235m,[39m[38;5;239m;[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;59m:[39m[38;5;16m.[39m[38;5;95m;[39m[38;5;187mC[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;145mf[39m[38;5;138m1[39m[38;5;138m1[39m[38;5;138mt[39m[38;5;138mt[39m[38;5;138mt[39m[38;5;102mi[39m[38;5;102m1[39m[38;5;224m0[39m[38;5;230m8[39m[38;5;187mC[39m[38;5;95m;[39m[38;5;16m.[39m[38;5;237m:[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;239m;[39m[38;5;235m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m [39m[38;5;236m,[39m[38;5;239mi[39m[38;5;240mi[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;239mi[39m[38;5;23m.[39m[38;5;59m,[39m[38;5;144mf[39m[38;5;224m0[39m[38;5;145mf[39m[38;5;138m1[39m[38;5;138m1[39m[38;5;138m1[39m[38;5;138m1[39m[38;5;138m1[39m[38;5;138mt[39m[38;5;145mf[39m[38;5;224m0[39m[38;5;144mf[39m[38;5;59m,[39m[38;5;17m.[39m[38;5;239mi[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;240mi[39m[38;5;239mi[39m[38;5;236m,[39m[38;5;232m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m.[39m[38;5;234m.[39m[38;5;235m,[39m[38;5;236m:[39m[38;5;238m;[39m[38;5;239m;[39m[38;5;59m,[39m[38;5;16m.[39m[38;5;101mi[39m[38;5;187mG[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;230m8[39m[38;5;187mG[39m[38;5;101mi[39m[38;5;16m.[39m[38;5;235m,[39m[38;5;239m;[39m[38;5;238m;[39m[38;5;236m:[39m[38;5;235m,[39m[38;5;234m.[39m[38;5;232m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m.[39m[38;5;233m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;59m,[39m[38;5;144mf[39m[38;5;187mC[39m[38;5;187mC[39m[38;5;187mC[39m[38;5;187mC[39m[38;5;144mf[39m[38;5;59m,[39m[38;5;16m [39m[38;5;232m [39m[38;5;233m.[39m[38;5;232m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;233m.[39m[38;5;235m,[39m[38;5;236m:[39m[38;5;237m:[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;237m;[39m[38;5;236m:[39m[38;5;234m,[39m[38;5;59m,[39m[38;5;16m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m.[39m[38;5;59m,[39m[38;5;234m,[39m[38;5;236m:[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;238m;[39m[38;5;237m:[39m[38;5;236m:[39m[38;5;235m,[39m[38;5;233m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;233m.[39m[38;5;237m:[39m[38;5;239mi[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;241mi[39m[38;5;240mi[39m[38;5;234m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m.[39m[38;5;240mi[39m[38;5;241mi[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;239mi[39m[38;5;237m:[39m[38;5;233m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;233m.[39m[38;5;238m;[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;237m:[39m[38;5;16m [39m[38;5;100m;[39m[38;5;100m;[39m[38;5;16m [39m[38;5;237m:[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;238m;[39m[38;5;233m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;235m,[39m[38;5;102mi[39m[38;5;102mi[39m[38;5;102m;[39m[38;5;59m;[39m[38;5;59m;[39m[38;5;66m;[39m[38;5;102mi[39m[38;5;102m1[39m[38;5;102m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;240mi[39m[38;5;16m [39m[38;5;58m,[39m[38;5;215mf[39m[38;5;215mf[39m[38;5;58m,[39m[38;5;16m [39m[38;5;240mi[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;102m1[39m[38;5;102mi[39m[38;5;66m;[39m[38;5;59m;[39m[38;5;59m;[39m[38;5;102m;[39m[38;5;102mi[39m[38;5;102mi[39m[38;5;235m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m.[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;58m,[39m[38;5;58m:[39m[38;5;94m;[39m[38;5;100m;[39m[38;5;94m:[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;59m:[39m[38;5;59m;[39m[38;5;102mi[39m[38;5;102mi[39m[38;5;241m1[39m[38;5;241m1[39m[38;5;59m,[39m[38;5;16m.[39m[38;5;179mt[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;179mt[39m[38;5;16m.[39m[38;5;59m,[39m[38;5;241m1[39m[38;5;102m1[39m[38;5;102mi[39m[38;5;102mi[39m[38;5;59m;[39m[38;5;59m:[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;94m:[39m[38;5;100m;[39m[38;5;94m;[39m[38;5;58m:[39m[38;5;58m,[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;16m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;58m,[39m[38;5;94m:[39m[38;5;100m;[39m[38;5;136mi[39m[38;5;137mi[39m[38;5;137mi[39m[38;5;136mi[39m[38;5;100m;[39m[38;5;100m;[39m[38;5;136mi[39m[38;5;137mi[39m[38;5;137mi[39m[38;5;137mi[39m[38;5;136mi[39m[38;5;100m;[39m[38;5;94m:[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;59m,[39m[38;5;59m.[39m[38;5;16m [39m[38;5;100m;[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;100m;[39m[38;5;16m [39m[38;5;59m.[39m[38;5;59m,[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;94m:[39m[38;5;100m;[39m[38;5;136mi[39m[38;5;137mi[39m[38;5;137mi[39m[38;5;137mi[39m[38;5;136mi[39m[38;5;100m;[39m[38;5;100m;[39m[38;5;136mi[39m[38;5;137mi[39m[38;5;137mi[39m[38;5;136mi[39m[38;5;100m;[39m[38;5;94m:[39m[38;5;58m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;58m.[39m[38;5;94m:[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;58m.[39m[38;5;16m.[39m[38;5;16m [39m[38;5;232m.[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;58m:[39m[38;5;94m:[39m[38;5;100m;[39m[38;5;100m;[39m[38;5;94m:[39m[38;5;16m [39m[38;5;58m,[39m[38;5;215mf[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;215mf[39m[38;5;58m,[39m[38;5;16m [39m[38;5;94m:[39m[38;5;100m;[39m[38;5;100m;[39m[38;5;94m:[39m[38;5;58m:[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;59m,[39m[38;5;59m,[39m[38;5;59m:[39m[38;5;59m:[39m[38;5;232m.[39m[38;5;16m [39m[38;5;16m.[39m[38;5;58m.[39m[38;5;58m,[39m[38;5;58m,[39m[38;5;94m:[39m[38;5;58m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;232m [39m[38;5;238m;[39m[38;5;241m1[39m[38;5;241m1[39m[38;5;102m1[39m[38;5;241mi[39m[38;5;102mi[39m[38;5;102mi[39m[38;5;102m;[39m[38;5;59m;[39m[38;5;59m:[39m[38;5;16m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;52m.[39m[38;5;179mt[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;179mt[39m[38;5;52m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m.[39m[38;5;59m:[39m[38;5;59m;[39m[38;5;102m;[39m[38;5;102mi[39m[38;5;102mi[39m[38;5;241mi[39m[38;5;241m1[39m[38;5;241m1[39m[38;5;241mi[39m[38;5;238m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;237m;[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;241m1[39m[38;5;241mi[39m[38;5;240mi[39m[38;5;238m;[39m[38;5;234m,[39m[38;5;16m.[39m[38;5;94m:[39m[38;5;179mt[39m[38;5;215mL[39m[38;5;221mL[39m[38;5;221mL[39m[38;5;215mL[39m[38;5;179mt[39m[38;5;94m:[39m[38;5;16m.[39m[38;5;234m,[39m[38;5;238m;[39m[38;5;240mi[39m[38;5;241m1[39m[38;5;241m1[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;237m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;236m:[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;241m1[39m[38;5;102m;[39m[38;5;59m,[39m[38;5;16m.[39m[38;5;94m:[39m[38;5;137m1[39m[38;5;137m1[39m[38;5;94m:[39m[38;5;16m.[39m[38;5;59m,[39m[38;5;102m;[39m[38;5;241m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;236m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;234m,[39m[38;5;241mi[39m[38;5;242m1[39m[38;5;242mi[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242mi[39m[38;5;102m;[39m[38;5;59m,[39m[38;5;16m.[39m[38;5;16m.[39m[38;5;59m,[39m[38;5;102m;[39m[38;5;242mi[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242m1[39m[38;5;242mi[39m[38;5;242m1[39m[38;5;241mi[39m[38;5;234m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;237m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;243m.[39m[38;5;242m.[39m[38;5;59m [39m[38;5;59m [39m[38;5;242m.[39m[38;5;243m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;242m.[39m[38;5;237m.[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
EOF

spinner() {
    i=1
    sp="/-\|"
    echo -n ' '
    while true
    do
        printf "\b${sp:i++%${#sp}:1}"
        sleep .05
    done
}

install_spell() {
    SPELL_NAME=$1
    if [ -z $3 ]; then
        VERSION=
        LOCK=$2
    else
        VERSION=$2
        LOCK=$3
    fi

    if [ -z $VERSION ]; then
        printf "Installing spell: ${YELLOW}${SPELL_NAME}${NC}\n"
    else
        printf "Installing spell: ${YELLOW}${SPELL_NAME}${NC}:${YELLOW}${VERSION}${NC}\n"
    fi

    spinner &
    SPINNER_PID=$!

    RESPONSE=$(curl -s -w '%{http_code}' -X GET \
        $API_BASE/spell/$SPELL_NAME \
        -H 'cache-control: no-cache' \
        -H 'content-type: application/json')

    STATUS_CODE=$(echo $RESPONSE | tail -c 4)
    RESPONSE=${RESPONSE::-3}
    CLONE_FAIL=false
    BUILD_FAIL=false

    if [ $STATUS_CODE -eq 200 ]; then
        {
            SPELL_REPO=$(echo ${RESPONSE} | jq -r '.repo')

            if [ -z $VERSION ]; then
                BRANCH=$(git ls-remote --tags --refs ${SPELL_REPO} | tail -n1 | sed 's/.*\///')
                if [ -z $BRANCH ]; then
                    BRANCH=$(git remote show ${SPELL_REPO} | grep "HEAD branch" | cut -d ":" -f 2)
                    BRANCH="${BRANCH:1}"
                fi
                BRANCH_ORIG=$BRANCH
            else
                if [[ $VERSION =~ ^[0-9x]+(\.[0-9x]+){0,3}$ ]]; then
                    BRANCH_ORIG="$VERSION"
                    BRANCH="v$VERSION"
                    BRANCH=$(echo ${BRANCH} | tr x \*)
                    BRANCH=$(git ls-remote --tags --refs ${SPELL_REPO} | sed 's/.*\///' | grep ${BRANCH} | tail -n1)
                    if [ -z $BRANCH ]; then
                        BRANCH=$BRANCH_ORIG
                        CLONE_FAIL=true
                    fi
                else
                    BRANCH=$VERSION
                    BRANCH_ORIG=$VERSION
                fi
            fi

            mkdir -p spells
            cd spells/
            if [ -d "$SPELL_NAME" ]; then rm -rf $SPELL_NAME; fi
            git clone --depth=1 --branch $BRANCH $SPELL_REPO $SPELL_NAME || CLONE_FAIL=true
            cd $SPELL_NAME
            rm -rf .git/
            make || BUILD_FAIL=true
            cd ../..

            if [ $CLONE_FAIL = false ] && [ $BUILD_FAIL = false ]; then
                if [ $LOCK = false ]; then
                    cat $JSON_FILE | jq -r ".dependencies += {\"${SPELL_NAME}\": \"${BRANCH_ORIG}\"}" > tmp && mv tmp $JSON_FILE
                fi
                cat $LOCK_FILE | jq -r ".dependencies += {\"${SPELL_NAME}\": \"${BRANCH}\"}" > tmp && mv tmp $LOCK_FILE
            fi
        } &> /dev/null

        kill -9 $SPINNER_PID
        wait $SPINNER_PID 2>/dev/null
        printf "\b"

        if [ $CLONE_FAIL = true ]; then
            echo -e "${RED}Installation of ${YELLOW}${SPELL_NAME}${RED} is failed: Version ${YELLOW}${BRANCH}${RED} does not exists!${NC}"
            exit 3
        elif [ $BUILD_FAIL = true ]; then
            echo -e "${RED}Installation of ${YELLOW}${SPELL_NAME}${NC}:${YELLOW}${BRANCH}${RED} is failed: Build failure!${NC}"
            exit 4
        fi

        echo -e "${GREEN}The spell ${YELLOW}${SPELL_NAME}${NC}:${YELLOW}${BRANCH}${GREEN} is successfully installed!${NC}"
        curl -s -o /dev/null -X GET \
            $API_BASE/spell/install/$SPELL_NAME \
            -H 'cache-control: no-cache' \
            -H 'content-type: application/json'
    elif [ $STATUS_CODE -eq 404 ]; then
        kill -9 $SPINNER_PID
        wait $SPINNER_PID 2>/dev/null
        printf "\b"
        echo -e "${RED}Couldn't find ${YELLOW}${SPELL_NAME}${RED} in the spell index!${NC}"
        exit 5
    else
        kill -9 $SPINNER_PID
        wait $SPINNER_PID 2>/dev/null
        printf "\b"
        echo -e "${RED}Search for the spell is failed!${NC}"
        exit 6
    fi
}

# Create or edit occultist.json
if [ $1 = "init" ]; then
    if [ ! -f $JSON_FILE ]; then
        echo -e "{\n}" > $JSON_FILE
    fi
    if cat $JSON_FILE | jq -e 'has("dependencies")' > /dev/null; then
        :
    else
        cat $JSON_FILE | jq -r '. += {"dependencies": {}}' > tmp && mv tmp $JSON_FILE
    fi

    read -p "$(echo -e ${YELLOW}Spell name: ${NC}${BOLD_NC})" spell_name
    read -p "$(echo -e ${YELLOW}Spell version: ${NC}${BOLD_NC})" spell_version
    read -p "$(echo -e ${YELLOW}Spell description: ${NC}${BOLD_NC})" spell_description

    echo -e "${UNDERLINED_NC}Select the spell type${NC}"
    PS3="Pick an option: "
    options=("module" "extension")
    select opt in "${options[@]}"; do
        case "$REPLY" in
        1 ) spell_type=$opt; echo -e "${YELLOW}Spell type: ${NC}${BOLD_NC}${opt}${NC}"; break;;
        2 ) spell_type=$opt; echo -e "${YELLOW}Spell type: ${NC}${BOLD_NC}${opt}${NC}"; break;;

        *) echo "Invalid option. Try another one.";continue;;
        esac
    done

    read -p "$(echo -e ${YELLOW}License: ${NC}${BOLD_NC})" license
    read -p "$(echo -e ${YELLOW}Author name: ${NC}${BOLD_NC})" author_name
    read -p "$(echo -e ${YELLOW}Author email: ${NC}${BOLD_NC})" author_email

    echo -e "${UNDERLINED_NC}Select the author's role${NC}"
    PS3="Pick an option: "
    options=("maintainer" "developer")
    select opt in "${options[@]}"; do
        case "$REPLY" in
        1 ) author_role=$opt; echo -e "${YELLOW}Author role: ${NC}${BOLD_NC}${opt}${NC}"; break;;
        2 ) author_role=$opt; echo -e "${YELLOW}Author role: ${NC}${BOLD_NC}${opt}${NC}"; break;;

        *) echo "Invalid option. Try another one.";continue;;
        esac
    done

    cat $JSON_FILE | jq -r ". += {\"name\": \"${spell_name}\"}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ". += {\"version\": \"${spell_version}\"}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ". += {\"description\": \"${spell_description}\"}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ". += {\"tags\": []}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ". += {\"type\": \"${spell_type}\"}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ". += {\"license\": \"${license}\"}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ". += {\"authors\": []}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ".authors[0] += {\"name\": \"${author_name}\"}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ".authors[0] += {\"email\": \"${author_email}\"}" > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ".authors[0] += {\"role\": \"${author_role}\"}" > tmp && mv tmp $JSON_FILE

    dependencies=$(jq -r '.dependencies' $JSON_FILE)
    jq -M "del(.dependencies)" $JSON_FILE > tmp && mv tmp $JSON_FILE
    cat $JSON_FILE | jq -r ". += {\"dependencies\": ${dependencies}}" > tmp && mv tmp $JSON_FILE

# Register the spell
elif [ $1 = "register" ]; then
    SPELL_NAME=$(jq -r '.name' $JSON_FILE)
    SPELL_VERSION=$(jq -r '.version' $JSON_FILE)
    SPELL_DESCRIPTION=$(jq -r '.description' $JSON_FILE)
    SPELL_TAGS=$(jq -r '.tags' $JSON_FILE)
    SPELL_TAGS_READABLE=$(jq -r '.tags | reduce .[1:][] as $i ("\(.[0])"; . + ", \($i)" )' $JSON_FILE)
    SPELL_TYPE=$(jq -r '.type' $JSON_FILE)
    SPELL_LICENSE=$(jq -r '.license' $JSON_FILE)
    SPELL_REPO=$(git config --get remote.origin.url)
    printf "%-20s ${YELLOW}%-20s${NC}\n" "Spell name:" "$SPELL_NAME"
    printf "%-20s ${YELLOW}%-20s${NC}\n" "Spell version:" "$SPELL_VERSION"
    printf "%-20s ${YELLOW}%-20s${NC}\n" "Spell description:" "$SPELL_DESCRIPTION"
    printf "%-20s ${YELLOW}%-20s${NC}\n" "Spell tags:" "$SPELL_TAGS_READABLE"
    printf "%-20s ${YELLOW}%-20s${NC}\n" "Spell type:" "$SPELL_TYPE"
    printf "%-20s ${YELLOW}%-20s${NC}\n" "Spell license:" "$SPELL_LICENSE"
    printf "%-20s ${YELLOW}%-20s${NC}\n" "Spell repository:" "$SPELL_REPO"

    spinner &
    SPINNER_PID=$!

    STATUS_CODE=$(curl -s -o /dev/null -w '%{http_code}' -X POST \
        $API_BASE/spell/create \
        -H 'cache-control: no-cache' \
        -H 'content-type: application/json' \
        -d "{
            \"name\": \"$SPELL_NAME\",
            \"repo\": \"$SPELL_REPO\"
        }")

    kill -9 $SPINNER_PID
    wait $SPINNER_PID 2>/dev/null
    printf "\b \n"

    if [ $STATUS_CODE -eq 200 ]; then
        echo -e "\n${GREEN}The spell is successfully registered!${NC}\n"
        exit 0
    elif [ $STATUS_CODE -eq 409 ]; then
        echo -e "\n${YELLOW}The spell is already registered!${NC}\n"
        exit 2
    else
        echo -e "\n${RED}Spell registration is failed!${NC}\n"
        exit 1
    fi

# Install spells
elif [ $1 = "install" ]; then
    if [ ! -f $JSON_FILE ]; then
        echo -e "{\n}" > $JSON_FILE
    fi
    if cat $JSON_FILE | jq -e 'has("dependencies")' > /dev/null; then
        :
    else
        cat $JSON_FILE | jq -r '. += {"dependencies": {}}' > tmp && mv tmp $JSON_FILE
    fi

    LOCK=true
    if [ ! -f $LOCK_FILE ]; then
        echo -e "{\n}" > $LOCK_FILE
        LOCK=false
    fi
    if cat $LOCK_FILE | jq -e 'has("dependencies")' > /dev/null; then
        :
    else
        cat $LOCK_FILE | jq -r '. += {"dependencies": {}}' > tmp && mv tmp $LOCK_FILE
    fi

    # Install all the dependencies
    if [ -z $2 ]; then
        if [ $LOCK = true ]; then
            SUBJECT_FILE=$LOCK_FILE
        else
            SUBJECT_FILE=$JSON_FILE
        fi
        while IFS== read -r key value; do
            install_spell $key $value $LOCK
        done < <(jq -r '.dependencies | to_entries | .[] | .key + "=" + .value ' $SUBJECT_FILE)
    # Install and save a specific spell
    else
        install_spell $2 $3 false
    fi

# Upgrade the spells
elif [ $1 = "upgrade" ]; then
    LOCK=false
    # Upgrade all the dependencies
    if [ -z $2 ]; then
        while IFS== read -r key value; do
            install_spell $key $value $LOCK
        done < <(jq -r '.dependencies | to_entries | .[] | .key + "=" + .value ' $JSON_FILE)
    # Upgrade and save a specific spell
    else
        SPELL_NAME=$2
        BRANCH=$(jq -r ".dependencies.${SPELL_NAME}" $JSON_FILE)
        install_spell $SPELL_NAME $BRANCH $LOCK
    fi

# Remove a spell
elif [ $1 = "remove" ]; then
    LOCK=false
    if [ -z $2 ]; then
        echo -e "\n${RED}You have to specifiy a spell name!${NC}\n"
        exit 7
    else
        SPELL_NAME=$2
        if cat $JSON_FILE | jq -e ".dependencies | has(\"${SPELL_NAME}\")" > /dev/null; then
            cd spells/ && \
            rm -rf $SPELL_NAME && \
            cd .. && \
            rmdir spells/ &> /dev/null
            jq -M "del(.dependencies.${SPELL_NAME})" $LOCK_FILE > tmp && mv tmp $LOCK_FILE && \
            jq -M "del(.dependencies.${SPELL_NAME})" $JSON_FILE > tmp && mv tmp $JSON_FILE && \
            echo -e "${GREEN}The spell ${YELLOW}${SPELL_NAME}${GREEN} is successfully removed!${NC}" || \
            echo -e "\n${RED}Failed to remove spell ${YELLOW}${SPELL_NAME}${RED}!${NC}\n"
        else
            echo -e "\n${RED}Spell ${YELLOW}${SPELL_NAME}${RED} is already removed!${NC}\n"
            exit 8
        fi
    fi
fi
